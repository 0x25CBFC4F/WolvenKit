<reactiveUi:ReactiveUserControl
    x:Class="WolvenKit.Views.Documents.RDTMeshView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ab3d="clr-namespace:Ab3d.Controls;assembly=Ab3d.PowerToys"
    xmlns:cameras="clr-namespace:Ab3d.Cameras;assembly=Ab3d.PowerToys"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:documents="clr-namespace:WolvenKit.ViewModels.Documents;assembly=WolvenKit.App"
    xmlns:dxControls="clr-namespace:Ab3d.DirectX.Controls;assembly=Ab3d.DXEngine.Wpf"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:reactiveUi="http://reactiveui.net"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:visuals="clr-namespace:Ab3d.Visuals;assembly=Ab3d.PowerToys"
    Margin="0"
    d:DataContext="{d:DesignInstance Type={x:Type documents:RDTMeshViewModel}}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:TypeArguments="documents:RDTMeshViewModel"
    BorderBrush="{StaticResource BorderAlt}"
    BorderThickness="1,0,1,1"
    mc:Ignorable="d">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>
        <syncfusion:SfGridSplitter Grid.Column="1" HorizontalAlignment="Stretch" />

        <Viewport3D
            Name="SkyboxViewport"
            Grid.Row="0"
            Grid.Column="0"
            Visibility="Visible">
            <visuals:MultiMaterialBoxVisual3D
                BackMaterial="Resources/SkyboxTextures/CloudyLightRaysBack512.png"
                BottomMaterial="Resources/SkyboxTextures/CloudyLightRaysDown512.png"
                CenterPosition="0 0 0"
                FrontMaterial="Resources/SkyboxTextures/CloudyLightRaysFront512.png"
                IsTwoSidedMaterial="True"
                LeftMaterial="Resources/SkyboxTextures/CloudyLightRaysLeft512.png"
                RightMaterial="Resources/SkyboxTextures/CloudyLightRaysRight512.png"
                Size="500 500 500"
                TopMaterial="Resources/SkyboxTextures/CloudyLightRaysUp512.png" />

            <ModelVisual3D>
                <ModelVisual3D.Content>
                    <Model3DGroup>
                        <AmbientLight Color="White" />
                    </Model3DGroup>
                </ModelVisual3D.Content>
            </ModelVisual3D>
        </Viewport3D>

        <cameras:TargetPositionCamera
            Name="SkyBoxCamera"
            Grid.Row="0"
            Grid.Column="0"
            Attitude="{Binding ElementName=Camera1, Path=Attitude}"
            Bank="{Binding ElementName=Camera1, Path=Bank}"
            Distance="200"
            Heading="{Binding ElementName=Camera1, Path=Heading}"
            ShowCameraLight="Never"
            TargetPosition="0 0 0"
            TargetViewport3D="{Binding ElementName=SkyboxViewport}" />

        <Border Name="ViewportBorder" Background="Transparent">
            <dxControls:DXViewportView
                Name="MainDXViewportView"
                BackgroundColor="Transparent"
                PresentationType="DirectXImage">

                <Viewport3D Name="MainViewport">
                    <ModelVisual3D x:Name="ContentVisual" />
                    <!--
                        visuals:SphereVisual3D
                        CenterPosition="5,5,5"
                        Material="White"
                        Radius="5" /
                    -->
                    <ModelVisual3D>
                        <ModelVisual3D.Content>
                            <Model3DGroup x:Name="LightsModel3DGroup">
                                <DirectionalLight
                                    x:Name="TopDirectionalLight"
                                    Direction="0 -1 0"
                                    Color="#afafaf" />
                                <DirectionalLight Direction="-1 0 0" Color="#4f4f4f" />
                                <DirectionalLight Direction="1 0 0" Color="#4f4f4f" />
                                <DirectionalLight Direction="0 0 1" Color="#4f4f4f" />
                                <DirectionalLight Direction="0 0 -1" Color="#4f4f4f" />
                                <DirectionalLight Direction="-1 0 1" Color="#4f4f4f" />
                                <DirectionalLight Direction="1 0 -1" Color="#4f4f4f" />
                                <DirectionalLight Direction="1 0 1" Color="#4f4f4f" />
                                <DirectionalLight Direction="-1 0 -1" Color="#4f4f4f" />
                            </Model3DGroup>
                        </ModelVisual3D.Content>
                    </ModelVisual3D>
                    <visuals:WireframeVisual3D
                        x:Name="ContentWireframeVisual"
                        LineColor="Black"
                        LineThickness="0.8"
                        ShowPolygonLines="True"
                        UseModelColor="False"
                        WireframeType="WireframeWithOriginalSolidModel" />
                    <!--
                        visuals:LightingRigVisual3D
                        x:Name="ContentLight"
                        AmbientLightColor="#666666"
                        BackLightColor="Black"
                        FillLightColor="Black"
                        KeyLightColor="#ffffff"
                        KeyLightDirection="0,-1,0" /
                    -->
                </Viewport3D>
            </dxControls:DXViewportView>
        </Border>
        <ab3d:ViewCubeCameraController
            x:Name="ViewCubeCameraController1"
            Width="100"
            Height="100"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            AmbientLightColor="{DynamicResource MahApps.Colors.AccentBase}"
            Foreground="{DynamicResource MahApps.Brushes.AccentBase}"
            IsEdgeSelectionEnabled="True"
            IsRotationCircleShown="True"
            SelectionBrush="{DynamicResource MahApps.Brushes.Accent3}"
            TargetCamera="{Binding ElementName=Camera1}" />
        <TextBlock
            Grid.Row="1"
            Grid.Column="1"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            FontSize="7"
            Text="Powered by Ab4d" />
        <cameras:TargetPositionCamera
            Name="Camera1"
            Attitude="-20"
            Bank="0"
            CameraType="OrthographicCamera"
            Distance="50"
            Heading="230"
            ShowCameraLight="Never"
            TargetPosition="0 0 0"
            TargetViewport3D="{Binding ElementName=MainViewport}" />

        <ab3d:MouseCameraController
            Name="MouseCameraController1"
            EventsSourceElement="{Binding ElementName=ViewportBorder}"
            MoveCameraConditions="MiddleMouseButtonPressed"
            MoveOnlyHorizontally="True"
            QuickZoomConditions="RightMouseButtonPressed"
            RotateCameraConditions="LeftMouseButtonPressed"
            TargetCamera="{Binding ElementName=Camera1}"
            ZoomMode="Viewport3DCenter" />

        <ab3d:CameraAxisPanel
            Width="50"
            Height="50"
            HorizontalAlignment="Left"
            VerticalAlignment="Bottom"
            Is3DAxesShown="True"
            TargetCamera="{Binding ElementName=Camera1}" />

        <StackPanel
            HorizontalAlignment="Stretch"
            VerticalAlignment="Top"
            Orientation="Vertical">

            <Expander
                Header="Assimp info"
                IsExpanded="False"
                Style="{StaticResource BaseStyle}"
                Visibility="Collapsed">
                <TextBlock
                    Name="FileFormatsTextBlock"
                    Margin="10,5,10,0"
                    Text=""
                    TextWrapping="Wrap" />
            </Expander>
        </StackPanel>

        <syncfusion:DropDownButton
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Label="Options">
            <syncfusion:DropDownButton.IconTemplate>
                <DataTemplate>
                    <iconPacks:PackIconRemixIcon
                        Width="12"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Kind="Settings2Fill" />
                </DataTemplate>
            </syncfusion:DropDownButton.IconTemplate>
            <Border
                Margin="5"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Background="Black"
                BorderBrush="Black"
                BorderThickness="2"
                Visibility="Visible">
                <StackPanel Margin="10,5" Orientation="Vertical">

                    <Button
                        Name="LoadButton"
                        Height="26"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Left"
                        Click="LoadButton_OnClick"
                        Content="Load file"
                        IsDefault="True"
                        Visibility="Collapsed" />

                    <TextBlock
                        Margin="0,10,0,0"
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="(or drag and drop 3D model file)"
                        Visibility="Collapsed" />

                    <CheckBox
                        Name="ShowWireframeCheckBox"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Left"
                        Checked="OnShowWireframeCheckBoxCheckedChanged"
                        Content="Show wireframe"
                        IsChecked="True"
                        Style="{DynamicResource MahApps.Styles.CheckBox.DataGrid.Win10}"
                        Unchecked="OnShowWireframeCheckBoxCheckedChanged" />
                    <CheckBox
                        Name="AddLineDepthBiasCheckBox"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Checked="OnAddLineDepthBiasCheckBoxCheckedChanged"
                        Content="Add line depth bias (DXEngine only)"
                        IsChecked="True"
                        IsEnabled="{Binding ElementName=ShowWireframeCheckBox, Path=IsChecked}"
                        Style="{DynamicResource MahApps.Styles.CheckBox.DataGrid.Win10}"
                        Unchecked="OnAddLineDepthBiasCheckBoxCheckedChanged" />
                    <CheckBox
                        Name="ReadPolygonIndicesCheckBox"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Checked="OnReadPolygonIndicesCheckBoxCheckedChanged"
                        Content="Read PolygonIndices"
                        IsChecked="True"
                        Style="{DynamicResource MahApps.Styles.CheckBox.DataGrid.Win10}"
                        ToolTip="When checked ReaderObj will read PolygonIndices collection that can be used to show polygons instead of triangles. Object need to be shown with wireframe to see the difference."
                        Unchecked="OnReadPolygonIndicesCheckBoxCheckedChanged" />

                    <Button
                        Name="ShowInfoButton"
                        Margin="0,20,0,0"
                        Click="ShowInfoButton_OnClick"
                        Content="Show objects info"
                        IsEnabled="False" />
                </StackPanel>
            </Border>
        </syncfusion:DropDownButton>
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />

                </Grid.ColumnDefinitions>
                <TextBlock
                    Margin="5,0,0,0"
                    VerticalAlignment="Center"
                    Text="Appearance: " />
                <ComboBox
                    Grid.Column="1"
                    Height="30"
                    Padding="10,0"
                    DisplayMemberPath="Name"
                    ItemsSource="{Binding Appearances, Mode=OneWay}"
                    SelectedItem="{Binding SelectedAppearance, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectionChanged="ReloadModels" />
            </Grid>
            <syncfusion:SfTreeGrid
                Grid.Row="1"
                AutoExpandMode="AllNodesExpanded"
                AutoGenerateColumns="False"
                CheckBoxMappingName="IsEnabled"
                ChildPropertyName="BindName"
                ItemsSource="{Binding SelectedAppearance.Models, Mode=TwoWay}"
                ParentPropertyName="Name"
                RowHeaderWidth="300"
                ShowCheckBox="True">
                <syncfusion:SfTreeGrid.Columns>
                    <syncfusion:TreeGridTextColumn
                        HeaderText="Component Name"
                        MappingName="Name"
                        MinimumWidth="300" />
                    <syncfusion:TreeGridTextColumn HeaderText="Bind Name" MappingName="BindName" />
                    <syncfusion:TreeGridTextColumn HeaderText="Slot Name" MappingName="SlotName" />
                </syncfusion:SfTreeGrid.Columns>
            </syncfusion:SfTreeGrid>
            <!--ItemsControl ItemsSource="{Binding SelectedAppearance.Models, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.Template>
                            <ControlTemplate>
                                <ItemsPresenter />
                            </ControlTemplate>
                        </ItemsControl.Template>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="5,0,0,0" Orientation="Vertical">
                                    <CheckBox
                                        Margin="0,2"
                                        Checked="ReloadModels"
                                        IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                        Unchecked="ReloadModels">
                                        <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                                    </CheckBox>
                                    <TextBlock
                                        Margin="20,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding BindName, StringFormat='bind: {0}'}" />
                                    <TextBlock
                                        Margin="20,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding SlotName, StringFormat='slot: {0}'}" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl-->
        </Grid>
    </Grid>
</reactiveUi:ReactiveUserControl>
