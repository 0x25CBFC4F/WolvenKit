<reactiveUi:ReactiveUserControl
    x:TypeArguments="tools:ProjectExplorerViewModel"
    x:Class="WolvenKit.Views.Tools.ProjectExplorerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:reactiveUi="http://reactiveui.net"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:tools="clr-namespace:WolvenKit.ViewModels.Tools;assembly=WolvenKit.App"
    xmlns:helpers="clr-namespace:WolvenKit.Functionality.Helpers"
    d:DataContext="{d:DesignInstance Type=tools:ProjectExplorerViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="400"
    mc:Ignorable="d">

   <UserControl.Resources>
       <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <hc:ThemeResources RequestedTheme="Dark" />
                <hc:Theme />
            </ResourceDictionary.MergedDictionaries>
            <DataTemplate x:Key="DragDropTemplate">
                <Border
                    x:Name="border" Width="250"  
                    Background="{StaticResource ContentBackgroundAlt}" 
                    BorderBrush="{StaticResource Border}" Padding="8"
                    BorderThickness="1">
                    <!-- this should update based on the context -->
                    <TextBlock Text="Move file(s) here - hold control to copy"
                        FontSize="12"
                        Foreground="#ffffff" />
                </Border>
            </DataTemplate>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid hc:ThemeManager.RequestedAccentColor="{DynamicResource MahApps.Brushes.Accent3}">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <syncfusion:TabControlExt
            Name="tabControl" Height="25" CloseButtonType="Hide"
            
            Margin="0,0,0,0"
            BorderThickness="0,0,0,1"
            TabItemSelectedForeground="White"
            TabItemHoverBackground="{StaticResource WolvenKitRedShadow}"
            TabItemHoverBorderBrush="{StaticResource WolvenKitRedShadow}"
            TabItemSelectedBackground="{StaticResource WolvenKitRed}"
            TabItemSelectedBorderBrush="{StaticResource WolvenKitCyan}">
            <syncfusion:TabItemExt Header="Source Files" />
            <syncfusion:TabItemExt Header="Packed Files" />
        </syncfusion:TabControlExt>

        <Border BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}" Height="Auto" Grid.Row="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <hc:SearchBar
                    x:Name="PESearchBar"
                    Margin="3"
                    BorderThickness="0,0,0,0"
                    Height="30"
                    Grid.Column="0"
                    BorderBrush="{StaticResource MahApps.Brushes.Gray.SemiTransparent}"
                    VerticalAlignment="Top"
                    Background="Transparent"
                    FlowDirection="LeftToRight"
                    SearchStarted="PESearchBar_OnSearchStarted"
                    ShowClearButton="True"
                    hc:InfoElement.Placeholder="Search"
                    Style="{StaticResource SearchBarExtendBaseStyle}"
                    hc:InfoElement.Necessary="True" />
                <StackPanel Orientation="Horizontal" Margin="0,0,3,0"
                    Grid.Column="1">
                    <Button Click="ExpandAll_OnClick" ToolTip="Expand All" Margin="3,0,0,0">
                        <iconPacks:PackIconCodicons
                                    Width="13"
                                    Height="13"
                                    Kind="ExpandAll" />
                    </Button>
                    <Button Click="CollapseAll_OnClick" ToolTip="Collapse All" Margin="3,0,0,0">
                        <iconPacks:PackIconCodicons
                                    Width="13"
                                    Height="13"
                                    Kind="CollapseAll" />
                    </Button>
                    <Button Click="ExpandChildren_OnClick" ToolTip="Expand Children" Margin="3,0,0,0">
                        <iconPacks:PackIconBootstrapIcons
                                    Width="13"
                                    Height="13"
                                    Kind="ArrowsExpand" />
                    </Button>
                    <Button Click="CollapseChildren_OnClick" ToolTip="Collapse Children" Margin="3,0,0,0">
                        <iconPacks:PackIconBootstrapIcons
                                    Width="13"
                                    Height="13"
                                    Kind="ArrowsCollapse" />
                    </Button>
                    <Button ToolTip="New Folder" Margin="3,0,0,0">
                        <iconPacks:PackIconCodicons
                                    Width="13"
                                    Height="13"
                                    Kind="NewFolder" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <syncfusion:SfTreeGrid
            Margin="0,0,0,0"
            Name="TreeGrid"
            AllowEditing="False"
            AllowFiltering="False"
            AllowResizingColumns="False"
            AutoExpandMode="AllNodesExpanded"
            AutoGenerateColumns="False"
            ChildPropertyName="ParentHash"
            ColumnSizer="Star"
            ExpandStateMappingName="IsExpanded"
            FilterLevel="Extended"
            IsReadOnly="True"
            LiveNodeUpdateMode="AllowDataShaping"
            PreviewMouseDown="TreeGrid_MouseDown"
            ParentPropertyName="Hash"
            RowHeight="19"
            SelectedItem="{Binding SelectedItem}"
            SelectedItems="{Binding SelectedItems}"
            SelectionMode="Extended"
            SelfRelationRootValue="0"
            BorderThickness="0"
            HeaderRowHeight="3"
            Grid.Row="2"
            CurrentCellBorderBrush="White"
            CurrentCellBorderThickness="0"
            AllowDrop="True"
            AllowDraggingRows="True"
            RowDropIndicatorMode="Line"
            RowDragDropTemplate="{StaticResource DragDropTemplate}"
            >

            <syncfusion:SfTreeGrid.Resources>
                <Style TargetType="syncfusion:TreeGridCell">
                    <Setter Property="BorderBrush" Value="Transparent" />
                    <Setter Property="BorderThickness" Value="0" />
                </Style>
                <Style TargetType="syncfusion:TreeGridExpanderCell">
                    <Setter Property="BorderBrush" Value="Transparent" />
                    <Setter Property="BorderThickness" Value="0" />
                </Style>
                <Style TargetType="syncfusion:TreeGridHeaderRowControl">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="BorderBrush" Value="Transparent" />
                    <Setter Property="Margin" Value="0,0,0,3" />
                </Style>
            </syncfusion:SfTreeGrid.Resources>

            <syncfusion:SfTreeGrid.Columns>
                <syncfusion:TreeGridTextColumn
                    HeaderText=""
                    HorizontalHeaderContentAlignment="Left"
                    ImmediateUpdateColumnFilter="True"
                    MappingName="Name">
                    <syncfusion:TreeGridTextColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.Resources>
                                    <Style x:Key="WolvenKitTreeGridButton" TargetType="{x:Type helpers:TreeGridButton}">
                                        <Setter Property="Border.Background" Value="{Binding BorderBrush, RelativeSource={RelativeSource Self}}"/>
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="Border.Padding" Value="5,0" />
                                        <Setter Property="Padding" Value="0" />
                                        <Setter Property="Margin" Value="5,0,0,0" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type helpers:TreeGridButton}">
                                                    <Border Background="{TemplateBinding Border.Background}" CornerRadius="2" Padding="{TemplateBinding Border.Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding IsDirectory}" Value="False"/>
                                                                <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Border}, AncestorLevel=1}}" Value="True" />
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </MultiDataTrigger>
                                                        <MultiTrigger>
                                                            <MultiTrigger.Conditions>
                                                                <Condition Property="IsMouseOver" Value="True"/>
                                                                <Condition Property="IsPressed" Value="True" />
                                                            </MultiTrigger.Conditions>
                                                            <Setter Property="Border.Background" Value="{Binding PressedBackground, RelativeSource={RelativeSource Self}}" />
                                                        </MultiTrigger>
                                                        <MultiTrigger>
                                                            <MultiTrigger.Conditions>
                                                                <Condition Property="IsMouseOver" Value="True"/>
                                                                <Condition Property="IsPressed" Value="False" />
                                                            </MultiTrigger.Conditions>
                                                            <Setter Property="Border.Background" Value="{Binding HoverBackground, RelativeSource={RelativeSource Self}}" />
                                                        </MultiTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                    <Style x:Key="WolvenKitTreeGridButtonDirectory" TargetType="{x:Type helpers:TreeGridButton}" BasedOn="{StaticResource WolvenKitTreeGridButton}">
                                        <Setter Property="Border.Padding" Value="2,0" />
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Border}, AncestorLevel=1}}" Value="True" />
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                    <Style x:Key="FolderIcon" TargetType="{x:Type iconPacks:PackIconControl}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="Kind" Value="{x:Static iconPacks:PackIconMaterialKind.Folder}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Extension}" Value="ModDirectoryTop">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Foreground" Value="{StaticResource WolvenKitRed}" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Extension}" Value="RawDirectoryTop">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Foreground" Value="{StaticResource WolvenKitTan}" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Extension}" Value="ScriptDirectoryTop">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Foreground" Value="{StaticResource WolvenKitCyan}" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Extension}" Value="TweakDirectoryTop">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Foreground" Value="{StaticResource WolvenKitPurple}" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Extension}" Value="OpenDirImageKey">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Foreground" Value="{StaticResource WolvenKitTan}" />
                                            </DataTrigger>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Path=IsExpanded, RelativeSource={RelativeSource AncestorType={x:Type syncfusion:TreeGridExpanderCell}}}" Value="True" />
                                                    <Condition Binding="{Binding Path=HasChildNodes, RelativeSource={RelativeSource AncestorType={x:Type syncfusion:TreeGridExpanderCell}}}" Value="True" />
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Kind" Value="{x:Static iconPacks:PackIconMaterialKind.FolderOpen}" />
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                    <Style x:Key="NormalIcon" TargetType="{x:Type Image}" BasedOn="{StaticResource FileIcons}">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger  Binding="{Binding Extension}" Value="ModDirectoryTop">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                            <DataTrigger  Binding="{Binding Extension}" Value="RawDirectoryTop">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                            <DataTrigger  Binding="{Binding Extension}" Value="ScriptDirectoryTop">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                            <DataTrigger  Binding="{Binding Extension}" Value="TweakDirectoryTop">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                            <DataTrigger  Binding="{Binding Extension}" Value="OpenDirImageKey">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Resources>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="13" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Image Height="13" Style="{StaticResource NormalIcon}" />
                                <iconPacks:PackIconControl Style="{StaticResource FolderIcon}" Width="13" Height="19"/>
                                <TextBlock
                                    x:Name="TemplateTextBlock"
                                    Grid.Column="1"
                                    Margin="5,0,0,2"
                                    VerticalAlignment="Center"
                                    Text="{Binding Path=Name}" />
                                <StackPanel Orientation="Horizontal" Grid.Column="2" Background="{StaticResource ContentBackground}">
                                    <helpers:TreeGridButton
                                        Style="{StaticResource WolvenKitTreeGridButton}"
                                        Command="{Binding OpenFileCommand}"
                                        ToolTip="Open this file"
                                        BorderBrush="{StaticResource WolvenKitCyan}"
                                        HoverBackground="{StaticResource WolvenKitCyanShadow}">
                                        <helpers:TreeGridButton.Content>
                                            <iconPacks:PackIconMaterial Kind="OpenInNew" Height="11" Width="11" Foreground="#222"
                                        Margin="-1,0,0,0"/>
                                        </helpers:TreeGridButton.Content>
                                    </helpers:TreeGridButton>
                                    <helpers:TreeGridButton
                                        Style="{StaticResource WolvenKitTreeGridButtonDirectory}"
                                        Command="{Binding DeleteFileCommand}"
                                        ToolTip="Delete this file/folder"
                                        BorderBrush="{StaticResource WolvenKitRed}"
                                        HoverBackground="{StaticResource WolvenKitRedShadow}">
                                        <helpers:TreeGridButton.Content>
                                            <iconPacks:PackIconForkAwesome Kind="Trash" Height="11" Width="15"
                                        Margin="-1,0,0,0"/>
                                        </helpers:TreeGridButton.Content>
                                    </helpers:TreeGridButton>
                                    <helpers:TreeGridButton Style="{StaticResource WolvenKitTreeGridButtonDirectory}" Width="0" Margin="0,0,10,0"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </syncfusion:TreeGridTextColumn.CellTemplate>
                </syncfusion:TreeGridTextColumn>
            </syncfusion:SfTreeGrid.Columns>

            <syncfusion:SfTreeGrid.ContextMenu>
                <ContextMenu FontSize="11" Style="{DynamicResource WPFContextMenuStyle}">
                    <MenuItem
                        Margin="0"
                        Header="Actions"
                        Visibility="Collapsed">

                        <MenuItem Command="{Binding AddAllImportsCommand}" Header="Add all dependencies" />
                        <MenuItem Command="{Binding FastRenderCommand}" Header="Fast render" />
                    </MenuItem>

                        <MenuItem x:Name="ConvertToJsonMenuItem"
                                      Command="{Binding ConvertToJsonCommand}"
                                      Header="Convert to JSON">
                        <MenuItem.Icon>
                            <Grid>
                                <iconPacks:PackIconCodicons
                                    Width="13"
                                    Height="13"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="4,0,-4,0"
                                    Kind="Json" />
                                <iconPacks:PackIconCodicons
                                    Width="7"
                                    Height="11"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="-8,0,8,0"
                                    Kind="ArrowSmallRight" />
                            </Grid>
                        </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="ConvertFromJsonMenuItem"
                                      Command="{Binding ConvertFromJsonCommand}"
                                      Header="Convert from JSON">
                        <MenuItem.Icon>
                            <Grid>
                                <iconPacks:PackIconCodicons
                                    Width="13"
                                    Height="13"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="4,0,-4,0"
                                    Kind="Json" />
                                <iconPacks:PackIconCodicons
                                    Width="7"
                                    Height="11"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="-8,0,8,0"
                                    Kind="ArrowSmallLeft" />
                            </Grid>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                        <MenuItem x:Name="ConvertToXmlMenuItem"
                                      Command="{Binding ConvertToXmlCommand}"
                                      Header="Convert to XML">
                        <MenuItem.Icon>
                            <Grid>
                            <iconPacks:PackIconCodicons
                                    Width="13"
                                    Height="13"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="4,0,-4,0"
                                    Kind="Code" />
                            <iconPacks:PackIconCodicons
                                    Width="7"
                                    Height="11"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Padding="-8,0,8,0"
                                    Kind="ArrowSmallRight" />
                            </Grid>
                        </MenuItem.Icon>
                    </MenuItem>
                    <!--<MenuItem x:Name="ConvertFromXmlMenuItem"
                                      Command="{Binding ConvertFromXmlCommand}"
                                      Header="Convert from JSON" />-->

                        <MenuItem x:Name="BKImport"
                                      Command="{Binding Bk2ImportCommand}"
                                      Header="Import Avi to BK2" />
                    <MenuItem x:Name="BKExport"
                                      Command="{Binding Bk2ExportCommand}"
                                      Header="Export BK2 to Avi" />


                    <Separator/>
                    <MenuItem Command="{Binding RenameFileCommand}" Header="Rename" >
                        <MenuItem.Icon>
                            <iconPacks:PackIconForkAwesome
                                    Width="13"
                                    Height="13"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Stretch"
                                    Kind="Pencil" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Command="{Binding CopyFileCommand}" Header="Copy" >
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial
                                    Width="13"
                                    Height="13"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Stretch"
                                    Kind="ContentCopy" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Command="{Binding PasteFileCommand}" Header="Paste" >
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial
                                    Width="13"
                                    Height="13"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Stretch"
                                    Kind="ContentPaste" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>

                    <MenuItem Command="{Binding CopyRelPathCommand}" Header="Copy relative path" />
                    <MenuItem Command="{Binding OpenInFileExplorerCommand}" Header="Open in File Explorer" />
                    <MenuItem Command="{Binding OpenInAssetBrowserCommand}"
                        Header="Open in asset browser"
                        Visibility="Collapsed" />

                    <!--<Separator/>-->

                    <!--<MenuItem Click="ExpandChildren_OnClick" Header="Expand" />
                    <MenuItem Click="CollapseChildren_OnClick" Header="Collapse" />                    
                    <MenuItem Click="ExpandAll_OnClick" Header="Expand all" />
                    <MenuItem Click="CollapseAll_OnClick" Header="Collapse all" />-->
                </ContextMenu>
            </syncfusion:SfTreeGrid.ContextMenu>
        </syncfusion:SfTreeGrid>
    </Grid>
</reactiveUi:ReactiveUserControl>
